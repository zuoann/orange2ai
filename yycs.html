<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT 英语助手 - 教务决策版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; background: #f0f4f8; }
        .review-ping { animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite; }
        @keyframes ping { 75%, 100% { transform: scale(1.5); opacity: 0; } }
        .no-print { display: block; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="pb-20">

    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-30 px-4 py-4 border-b border-slate-200 no-print">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 text-white p-2.5 rounded-2xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                </div>
                <div>
                    <h1 class="font-black text-xl text-slate-800">Academic Analytics</h1>
                    <span id="reviewAlert" class="hidden flex items-center gap-1 text-[10px] font-bold text-red-500 animate-pulse">
                        <span class="relative flex h-2 w-2"><span class="review-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span></span>
                        今日有单词进入遗忘区
                    </span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Memory Health</div>
                    <div class="text-sm font-black text-green-600" id="memoryHealth">100%</div>
                </div>
                <button onclick="startReviewMode()" id="reviewBtn" class="hidden bg-red-500 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-red-100">立即复习</button>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto px-4 mt-8">
        <div class="flex bg-slate-200/50 p-1.5 rounded-2xl mb-8 max-w-xl mx-auto backdrop-blur-sm no-print">
            <button onclick="switchMode('explore')" id="btn-explore" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all bg-white text-indigo-600 shadow-sm">词海探索</button>
            <button onclick="switchMode('stats')" id="btn-stats" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500">维度分析</button>
            <button onclick="window.print()" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500">打印报告</button>
        </div>

        <div id="mode-stats" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col items-center">
                    <h4 class="text-sm font-black text-slate-800 self-start mb-4">词性掌握维度 (POS)</h4>
                    <div class="h-64 w-full">
                        <canvas id="posChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h4 class="text-sm font-black text-slate-800 mb-4">学习成长轨迹 (7日)</h4>
                    <div class="h-64 w-full">
                        <canvas id="learningChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="bg-indigo-900 text-white p-8 rounded-[2.5rem] shadow-xl mb-8">
                <h4 class="text-xs font-bold text-indigo-300 uppercase tracking-widest mb-2">Coach Comment / 教务点评</h4>
                <p id="repComment" class="text-lg font-medium italic">“ 系统正在分析您的学习行为数据... ”</p>
            </div>
        </div>

        <div id="mainApp" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </div>

    <script>
        // --- 1. 数据定义与初始化 ---
        const words = [
            { word: "curriculum", content: "n. 课程；全部课程", level: "Core" },
            { word: "pedagogy", content: "n. 教育学；教学法", level: "Expert" },
            { word: "assessment", content: "n. 评估；评价", level: "Daily" },
            { word: "facilitate", content: "v. 促进；帮助", level: "Action" },
            { word: "synergy", content: "n. 协同作用", level: "Admin" },
            { word: "implement", content: "v. 实施；执行", level: "Action" },
            { word: "comprehensive", content: "adj. 全面的；综合的", level: "Core" }
        ];

        let masteredWords = new Set(JSON.parse(localStorage.getItem('masteredWords')) || []);
        let masteryHistory = JSON.parse(localStorage.getItem('masteryHistory')) || {}; 
        let dailyGoal = 5;
        let posChart, learningChart;

        // --- 2. 页面管理 ---
        function switchMode(mode) {
            document.getElementById('mainApp').classList.toggle('hidden', mode !== 'explore');
            document.getElementById('mode-stats').classList.toggle('hidden', mode !== 'stats');
            
            // 更新按钮状态
            document.getElementById('btn-explore').className = mode === 'explore' ? 
                "flex-1 py-2.5 text-sm font-bold rounded-xl transition-all bg-white text-indigo-600 shadow-sm" : 
                "flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500";
            
            document.getElementById('btn-stats').className = mode === 'stats' ? 
                "flex-1 py-2.5 text-sm font-bold rounded-xl transition-all bg-white text-indigo-600 shadow-sm" : 
                "flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500";

            if (mode === 'explore') renderWords();
            if (mode === 'stats') renderStatsCharts();
        }

        // --- 3. 词库渲染与交互 ---
        function renderWords(filterWords = words) {
            const container = document.getElementById('mainApp');
            container.innerHTML = filterWords.map(w => `
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 hover:shadow-xl transition-all group">
                    <div class="flex justify-between items-start mb-4">
                        <span class="px-3 py-1 bg-indigo-50 text-indigo-600 text-[10px] font-black rounded-full uppercase tracking-wider">${w.level}</span>
                        ${masteredWords.has(w.word) ? '<span class="text-green-500 text-[10px] font-black italic">MASTERED</span>' : ''}
                    </div>
                    <h3 class="text-2xl font-black text-slate-800 mb-2">${w.word}</h3>
                    <p class="text-slate-500 text-sm mb-6">${w.content}</p>
                    <button onclick="markAsMastered('${w.word}')" 
                        class="${masteredWords.has(w.word) ? 'bg-slate-100 text-slate-400' : 'bg-slate-900 text-white'} w-full py-3 rounded-xl font-bold text-xs transition-transform active:scale-95">
                        ${masteredWords.has(w.word) ? 'RE-LEARN' : 'MARK AS MASTERED'}
                    </button>
                </div>
            `).join('');
        }

        function markAsMastered(word) {
            const today = new Date().toISOString().split('T')[0];
            if (masteredWords.has(word)) {
                masteredWords.delete(word);
            } else {
                masteredWords.add(word);
                if (!masteryHistory[today]) masteryHistory[today] = [];
                if (!masteryHistory[today].includes(word)) masteryHistory[today].push(word);
            }
            localStorage.setItem('masteredWords', JSON.stringify([...masteredWords]));
            localStorage.setItem('masteryHistory', JSON.stringify(masteryHistory));
            renderWords();
            checkMemoryDecay();
        }

        // --- 4. 核心逻辑：词性分析与记忆扫描 ---
        function analyzePOS() {
            const stats = { "名词(n.)": 0, "动词(v.)": 0, "形容词(adj.)": 0, "其他": 0 };
            masteredWords.forEach(wordStr => {
                const wordObj = words.find(w => w.word === wordStr);
                if (wordObj) {
                    const c = wordObj.content.toLowerCase();
                    if (c.includes("n.")) stats["名词(n.)"]++;
                    else if (c.includes("v.")) stats["动词(v.)"]++;
                    else if (c.includes("adj.")) stats["形容词(adj.)"]++;
                    else stats["其他"]++;
                }
            });
            return stats;
        }

        function checkMemoryDecay() {
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const dateStr = sevenDaysAgo.toISOString().split('T')[0];
            const wordsToReview = masteryHistory[dateStr] || [];
            
            const isHealthy = wordsToReview.length === 0;
            document.getElementById('reviewAlert').classList.toggle('hidden', isHealthy);
            document.getElementById('reviewBtn').classList.toggle('hidden', isHealthy);
            document.getElementById('memoryHealth').textContent = isHealthy ? "100%" : "85% (下降)";
            document.getElementById('memoryHealth').className = isHealthy ? "text-sm font-black text-green-600" : "text-sm font-black text-red-500";
            return wordsToReview;
        }

        function startReviewMode() {
            const wordsToReview = checkMemoryDecay();
            if (wordsToReview.length > 0) {
                const filtered = words.filter(w => wordsToReview.includes(w.word));
                renderWords(filtered);
                alert(`正在复习 7 天前掌握的 ${wordsToReview.length} 个单词`);
            }
        }

        // --- 5. 图表渲染 ---
        function renderStatsCharts() {
            // 词性环形图
            const posData = analyzePOS();
            const posCtx = document.getElementById('posChart').getContext('2d');
            if (posChart) posChart.destroy();
            posChart = new Chart(posCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(posData),
                    datasets: [{
                        data: Object.values(posData),
                        backgroundColor: ['#6366f1', '#ec4899', '#f59e0b', '#94a3b8'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
            });

            // 学习轨迹图
            const learningCtx = document.getElementById('learningChart').getContext('2d');
            const labels = [];
            const data = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const ds = d.toISOString().split('T')[0];
                labels.push(ds.split('-').slice(1).join('/'));
                data.push(masteryHistory[ds] ? masteryHistory[ds].length : 0);
            }
            if (learningChart) learningChart.destroy();
            learningChart = new Chart(learningCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{ label: '掌握数', data: data, borderColor: '#6366f1', tension: 0.4, fill: true, backgroundColor: 'rgba(99,102,241,0.1)' }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });

            // 生成点评
            generateCoachComment(data.reduce((a, b) => a + b, 0));
        }

        function generateCoachComment(weeklyCount) {
            const pos = analyzePOS();
            const total = masteredWords.size;
            let comment = weeklyCount > 5 ? "本周表现卓越！教务系统显示您保持了高频的学习输出。" : "节奏较平稳。";
            
            if (total > 0 && (pos["动词(v.)"] / total) < 0.2) {
                comment += " 注意：动词比例较低。在职场沟通中，准确使用动词（Action Verbs）能大幅提升表达的专业度。";
            } else {
                comment += " 词汇维度分布均衡，非常适合职场综合应用场景。";
            }
            document.getElementById('repComment').textContent = `“ ${comment} ”`;
        }

        // --- 初始化 ---
        window.onload = () => {
            renderWords();
            checkMemoryDecay();
        };
    </script>
</body>
</html>
