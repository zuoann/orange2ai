<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT äº’åŠ¨è‹±è¯­å­¦ä¹ åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .perspective-1000 { perspective: 1000px; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .transform-style-3d { transform-style: preserve-3d; }
        
        .card-inner {
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .flipped { transform: rotateY(180deg); }

        /* è‡ªå®šä¹‰ Markdown æ ·å¼ */
        .content-body h3 { font-weight: bold; color: #2563eb; margin-top: 8px; border-left: 3px solid #2563eb; padding-left: 8px; }
        .content-body p { margin-bottom: 4px; }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .animate-celebrate { animation: celebrate 0.5s ease-out; }
    </style>
</head>
<body class="bg-indigo-50 min-h-screen pb-20">

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <nav class="bg-white shadow-sm sticky top-0 z-30 px-4 py-3">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 text-white p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                </div>
                <span class="font-bold text-xl text-slate-800 tracking-tight">GPT Learner</span>
            </div>
            
            <div class="flex items-center gap-6 text-sm font-medium">
                <div class="flex items-center gap-1 text-orange-500">
                    <span>ğŸ”¥</span> <span id="streakVal">0</span> å¤©
                </div>
                <div class="flex items-center gap-1 text-blue-600">
                    <span>ğŸ’</span> <span id="xpVal">0</span> XP
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-4 mt-6">
        
        <!-- åŠ è½½æ•°æ®/è®¾ç½® -->
        <div id="fileLoader" class="bg-white rounded-2xl p-8 text-center shadow-xl border-2 border-dashed border-indigo-200 mb-8">
            <h2 class="text-2xl font-bold mb-4">å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿ</h2>
            <p class="text-slate-500 mb-6">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½æ‚¨çš„è¯åº“æ–‡ä»¶ <code class="bg-slate-100 px-1 rounded">gptwords.json</code></p>
            <button id="loadBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-full font-bold transition-all transform hover:scale-105 shadow-lg flex items-center gap-2 mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                è½½å…¥è¯åº“
            </button>
            <p id="errorMsg" class="mt-4 text-red-500 text-sm hidden"></p>
        </div>

        <!-- ä¸»æ“ä½œåŒº -->
        <div id="mainApp" class="hidden">
            
            <!-- æ¨¡å¼å¯¼èˆª -->
            <div class="flex bg-white p-1 rounded-xl shadow-sm mb-6 max-w-sm mx-auto">
                <button onclick="switchMode('explore')" id="btn-explore" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all bg-indigo-600 text-white">æ¢ç´¢</button>
                <button onclick="switchMode('cards')" id="btn-cards" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all text-slate-500 hover:bg-slate-50">é—ªå¡</button>
                <button onclick="switchMode('quiz')" id="btn-quiz" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all text-slate-500 hover:bg-slate-50">æŒ‘æˆ˜</button>
            </div>

            <!-- 1. æ¢ç´¢æ¨¡å¼ -->
            <div id="mode-explore" class="space-y-4">
                <div class="flex gap-4 mb-6">
                    <input type="text" id="searchInput" placeholder="æœç´¢ä»»ä½•å•è¯æˆ–æ„æ€..." class="flex-1 px-4 py-3 rounded-xl border-none shadow-sm focus:ring-2 focus:ring-indigo-500">
                </div>
                <div id="exploreList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- 2. é—ªå¡æ¨¡å¼ -->
            <div id="mode-cards" class="hidden text-center">
                <div class="relative w-full max-w-md mx-auto aspect-[3/4] perspective-1000 group">
                    <div id="flashcard" class="card-inner relative w-full h-full transform-style-3d cursor-pointer shadow-2xl rounded-3xl" onclick="flipCard()">
                        <!-- æ­£é¢ -->
                        <div class="absolute inset-0 backface-hidden bg-white flex flex-col items-center justify-center p-10 rounded-3xl border-4 border-indigo-100">
                            <span class="text-sm text-indigo-400 font-bold uppercase tracking-widest mb-4">Word</span>
                            <h2 id="cardWord" class="text-5xl font-extrabold text-slate-800 break-words w-full text-center">---</h2>
                            <p class="mt-12 text-slate-400 text-sm italic">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹é‡Šä¹‰</p>
                        </div>
                        <!-- èƒŒé¢ -->
                        <div class="absolute inset-0 backface-hidden rotate-y-180 bg-indigo-600 text-white flex flex-col p-8 rounded-3xl overflow-y-auto">
                            <span class="text-sm text-indigo-200 font-bold uppercase tracking-widest mb-4 text-center">Meaning</span>
                            <div id="cardContent" class="content-body text-left text-sm leading-relaxed text-indigo-50"></div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 flex justify-center gap-4">
                    <button onclick="prevCard()" class="p-4 bg-white rounded-full shadow-md text-slate-600 hover:text-indigo-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <button onclick="markMasteredFromCard()" class="px-8 py-4 bg-green-500 text-white rounded-full shadow-lg font-bold hover:bg-green-600 transition-all flex items-center gap-2">
                        <span>âœ…</span> æ ‡è®°å·²æŒæ¡
                    </button>
                    <button onclick="nextCard()" class="p-4 bg-white rounded-full shadow-md text-slate-600 hover:text-indigo-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </div>
                <p class="mt-4 text-slate-400 text-sm">å¡ç‰‡: <span id="cardProgress">0/0</span></p>
            </div>

            <!-- 3. æŒ‘æˆ˜æ¨¡å¼ -->
            <div id="mode-quiz" class="hidden">
                <div class="bg-white rounded-3xl p-8 shadow-xl max-w-2xl mx-auto border border-indigo-50">
                    <div class="flex justify-between items-center mb-6">
                        <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold uppercase">Quiz Challenge</span>
                        <span id="quizScore" class="font-bold text-indigo-600">å¾—åˆ†: 0</span>
                    </div>
                    <h2 class="text-sm text-slate-400 mb-2">è¿™ä¸ªå•è¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h2>
                    <h3 id="quizWord" class="text-4xl font-black text-slate-800 mb-8">---</h3>
                    <div id="quizOptions" class="grid grid-cols-1 gap-3">
                        <!-- é€‰é¡¹ -->
                    </div>
                    <div id="quizFeedback" class="mt-6 hidden p-4 rounded-xl text-center font-bold"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- åº•éƒ¨æ¶ˆæ¯æç¤º (ä»£æ›¿ alert) -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 transform scale-0 transition-transform bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-2">
        <span id="toastIcon">ğŸ’¡</span>
        <span id="toastMsg">æ¶ˆæ¯å†…å®¹</span>
    </div>

    <script>
        // æ ¸å¿ƒçŠ¶æ€
        let words = [];
        let masteredWords = new Set(JSON.parse(localStorage.getItem('masteredWords') || '[]'));
        let xp = parseInt(localStorage.getItem('xp') || '0');
        let streak = parseInt(localStorage.getItem('streak') || '1');
        let currentMode = 'explore';
        let cardIdx = 0;
        let quizTarget = null;

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateStats();

        // åŠ è½½é€»è¾‘
        document.getElementById('loadBtn').onclick = async () => {
            const btn = document.getElementById('loadBtn');
            const err = document.getElementById('errorMsg');
            btn.textContent = 'åŠ è½½ä¸­...';
            
            try {
                if (window.location.protocol === 'file:') {
                    throw new Error("è¯·é€šè¿‡æœåŠ¡å™¨è¿è¡Œæ­¤é¡µé¢ï¼ˆå¦‚ Live Serverï¼‰");
                }
                const res = await fetch('gptwords.json');
                if (!res.ok) throw new Error("æ–‡ä»¶æœªæ‰¾åˆ°");
                
                const text = await res.text();
                words = parseGptJson(text);
                
                if (words.length > 0) {
                    document.getElementById('fileLoader').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    renderExplore();
                    updateFlashcard();
                    showToast("æˆåŠŸåŠ è½½è¯åº“ï¼", "ğŸ‰");
                }
            } catch (e) {
                err.textContent = e.message;
                err.classList.remove('hidden');
                btn.textContent = 'é‡è¯•è½½å…¥';
            }
        };

        function parseGptJson(text) {
            text = text.trim();
            if (text.startsWith('[') && text.endsWith(']')) {
                return JSON.parse(text);
            }
            return text.split('\n').filter(l => l.trim()).map(l => JSON.parse(l));
        }

        // æ¨¡å¼åˆ‡æ¢
        function switchMode(mode) {
            document.querySelectorAll('[id^="mode-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(`mode-${mode}`).classList.remove('hidden');
            
            document.querySelectorAll('[id^="btn-"]').forEach(btn => {
                btn.className = "flex-1 py-2 text-sm font-bold rounded-lg transition-all text-slate-500 hover:bg-slate-50";
            });
            const activeBtn = document.getElementById(`btn-${mode}`);
            activeBtn.className = "flex-1 py-2 text-sm font-bold rounded-lg transition-all bg-indigo-600 text-white shadow-md";
            
            currentMode = mode;
            if (mode === 'quiz') startNewQuiz();
        }

        // --- æ¢ç´¢æ¨¡å¼ ---
        function renderExplore() {
            const container = document.getElementById('exploreList');
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = words.filter(w => w.word.toLowerCase().includes(query) || (w.content && w.content.toLowerCase().includes(query)));
            
            container.innerHTML = filtered.slice(0, 50).map((w, idx) => `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:border-indigo-200 transition-all group">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-bold text-slate-800">${w.word}</h3>
                        <button onclick="toggleMastered('${w.word}')" class="text-xl grayscale group-hover:grayscale-0 transition-all">
                            ${masteredWords.has(w.word) ? 'âœ…' : 'âšª'}
                        </button>
                    </div>
                    <div class="content-body text-xs text-slate-600 line-clamp-3">${formatContent(w.content)}</div>
                </div>
            `).join('');
        }

        document.getElementById('searchInput').oninput = renderExplore;

        // --- é—ªå¡æ¨¡å¼ ---
        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function updateFlashcard() {
            if (words.length === 0) return;
            const w = words[cardIdx];
            document.getElementById('flashcard').classList.remove('flipped');
            setTimeout(() => {
                document.getElementById('cardWord').textContent = w.word;
                document.getElementById('cardContent').innerHTML = formatContent(w.content);
                document.getElementById('cardProgress').textContent = `${cardIdx + 1}/${words.length}`;
            }, 150);
        }

        function nextCard() { cardIdx = (cardIdx + 1) % words.length; updateFlashcard(); }
        function prevCard() { cardIdx = (cardIdx - 1 + words.length) % words.length; updateFlashcard(); }

        function markMasteredFromCard() {
            toggleMastered(words[cardIdx].word);
            nextCard();
        }

        // --- æŒ‘æˆ˜æ¨¡å¼ ---
        function startNewQuiz() {
            if (words.length < 4) return;
            const feedback = document.getElementById('quizFeedback');
            feedback.classList.add('hidden');
            
            // éšæœºé€‰ä¸€ä¸ªå•è¯
            const target = words[Math.floor(Math.random() * words.length)];
            quizTarget = target;
            document.getElementById('quizWord').textContent = target.word;
            
            // ç”Ÿæˆé€‰é¡¹
            let options = [target];
            while (options.length < 4) {
                let r = words[Math.floor(Math.random() * words.length)];
                if (!options.includes(r)) options.push(r);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('quizOptions').innerHTML = options.map(opt => `
                <button onclick="checkAnswer('${opt.word}')" class="w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-300 hover:bg-indigo-50 transition-all font-medium text-slate-700">
                    ${getShortDefinition(opt.content)}
                </button>
            `).join('');
        }

        function checkAnswer(word) {
            const feedback = document.getElementById('quizFeedback');
            feedback.classList.remove('hidden');
            
            if (word === quizTarget.word) {
                feedback.textContent = "å¤ªæ£’äº†ï¼ç­”å¯¹äº† ğŸŒŸ";
                feedback.className = "mt-6 p-4 rounded-xl text-center font-bold bg-green-100 text-green-700";
                addXP(10);
                document.getElementById('quizScore').classList.add('animate-celebrate');
                setTimeout(() => document.getElementById('quizScore').classList.remove('animate-celebrate'), 500);
            } else {
                feedback.textContent = `å“å‘€ï¼Œç­”é”™äº†ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯: ${quizTarget.word}`;
                feedback.className = "mt-6 p-4 rounded-xl text-center font-bold bg-red-100 text-red-700";
            }
            
            setTimeout(startNewQuiz, 1500);
        }

        // --- å·¥å…·å‡½æ•° ---
        function toggleMastered(word) {
            if (masteredWords.has(word)) {
                masteredWords.delete(word);
            } else {
                masteredWords.add(word);
                addXP(5);
                showToast(`å·²æŒæ¡å•è¯: ${word}`, "ğŸ¯");
            }
            localStorage.setItem('masteredWords', JSON.stringify([...masteredWords]));
            renderExplore();
            updateStats();
        }

        function addXP(amount) {
            xp += amount;
            localStorage.setItem('xp', xp);
            updateStats();
        }

        function updateStats() {
            document.getElementById('xpVal').textContent = xp;
            document.getElementById('streakVal').textContent = streak;
            document.getElementById('quizScore').textContent = `å¾—åˆ†: ${xp}`;
        }

        function showToast(msg, icon = 'ğŸ’¡') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            document.getElementById('toastIcon').textContent = icon;
            toast.className = "fixed bottom-10 left-1/2 -translate-x-1/2 transform scale-100 transition-transform bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-2";
            setTimeout(() => { toast.classList.add('scale-0'); toast.classList.remove('scale-100'); }, 3000);
        }

        function getShortDefinition(content) {
            if (!content) return "æš‚æ— è§£æ";
            const firstLine = content.split('\n')[0].replace(/#|\*|åˆ†æè¯ä¹‰:|åˆ†æè¯ä¹‰/g, '').trim();
            return firstLine.substring(0, 60) + (firstLine.length > 60 ? '...' : '');
        }

        function formatContent(content) {
            if (!content) return '';
            return content
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^\* (.*$)/gim, '<li>$1</li>')
                .replace(/\n\n/g, '<p></p>');
        }
    </script>
</body>
</html>
