<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT è‹±è¯­åŠ©æ‰‹ - æ•™åŠ¡å†³ç­–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Inter', 'Noto Sans SC', sans-serif; background: #f0f4f8; }
        .review-ping { animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite; }
        @keyframes ping { 75%, 100% { transform: scale(1.5); opacity: 0; } }
        /* ä¿æŒä¹‹å‰çš„é—ªå¡å’Œæ‰“å°æ ·å¼... */
    </style>
</head>
<body class="pb-20">

    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-30 px-4 py-4 border-b border-slate-200 no-print">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 text-white p-2.5 rounded-2xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                </div>
                <div>
                    <h1 class="font-black text-xl text-slate-800">Academic Analytics</h1>
                    <span id="reviewAlert" class="hidden flex items-center gap-1 text-[10px] font-bold text-red-500 animate-pulse">
                        <span class="relative flex h-2 w-2"><span class="review-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span></span>
                        ä»Šæ—¥æœ‰å•è¯è¿›å…¥é—å¿˜åŒº
                    </span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-right hidden sm:block">
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Memory Health</div>
                    <div class="text-sm font-black text-green-600" id="memoryHealth">100%</div>
                </div>
                <button onclick="startReviewMode()" id="reviewBtn" class="hidden bg-red-500 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-red-100">ç«‹å³å¤ä¹ </button>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto px-4 mt-8">
        <div class="flex bg-slate-200/50 p-1.5 rounded-2xl mb-8 max-w-xl mx-auto backdrop-blur-sm nav-tabs">
            <button onclick="switchMode('explore')" id="btn-explore" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all bg-white text-indigo-600 shadow-sm">è¯æµ·æ¢ç´¢</button>
            <button onclick="switchMode('stats')" id="btn-stats" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500">ç»´åº¦åˆ†æ</button>
            <button onclick="generateWeeklyReport()" class="flex-1 py-2.5 text-sm font-bold rounded-xl transition-all text-slate-500">ç”Ÿæˆå‘¨æŠ¥</button>
        </div>

        <div id="mode-stats" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col items-center">
                    <h4 class="text-sm font-black text-slate-800 self-start mb-4">è¯æ€§æŒæ¡ç»´åº¦ (POS)</h4>
                    <div class="h-64 w-full">
                        <canvas id="posChart"></canvas>
                    </div>
                </div>
                <div class="lg:col-span-2 bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h4 class="text-sm font-black text-slate-800 mb-4">å­¦ä¹ æˆé•¿è½¨è¿¹</h4>
                    <div class="h-64 w-full">
                        <canvas id="learningChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="mainApp">
            </div>
    </div>

    <script>
        // --- æ ¸å¿ƒå˜é‡ ---
        let posChart = null;
        let learningChart = null;

        // --- æ™ºèƒ½è¯æ€§åˆ†æé€»è¾‘ ---
        function analyzePOS() {
            const stats = { "åè¯(n.)": 0, "åŠ¨è¯(v.)": 0, "å½¢å®¹è¯(adj.)": 0, "å‰¯è¯(adv.)": 0, "å…¶ä»–": 0 };
            
            masteredWords.forEach(wordStr => {
                const wordObj = words.find(w => w.word === wordStr);
                if (wordObj && wordObj.content) {
                    const content = wordObj.content.toLowerCase();
                    if (content.includes("n.") || content.includes("åè¯")) stats["åè¯(n.)"]++;
                    else if (content.includes("v.") || content.includes("åŠ¨è¯")) stats["åŠ¨è¯(v.)"]++;
                    else if (content.includes("adj.") || content.includes("å½¢å®¹è¯")) stats["å½¢å®¹è¯(adj.)"]++;
                    else if (content.includes("adv.") || content.includes("å‰¯è¯")) stats["å‰¯è¯(adv.)"]++;
                    else stats["å…¶ä»–"]++;
                }
            });
            return stats;
        }

        // --- é—å¿˜æ›²çº¿æ‰«æå™¨ ---
        function checkMemoryDecay() {
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const dateStr = sevenDaysAgo.toISOString().split('T')[0];
            
            const wordsToReview = masteryHistory[dateStr] || [];
            
            if (wordsToReview.length > 0) {
                document.getElementById('reviewAlert').classList.remove('hidden');
                document.getElementById('reviewBtn').classList.remove('hidden');
                document.getElementById('memoryHealth').textContent = "85% (ä¸‹é™)";
                document.getElementById('memoryHealth').className = "text-sm font-black text-red-500";
                return wordsToReview;
            } else {
                document.getElementById('reviewAlert').classList.add('hidden');
                document.getElementById('reviewBtn').classList.add('hidden');
                document.getElementById('memoryHealth').textContent = "100%";
                document.getElementById('memoryHealth').className = "text-sm font-black text-green-600";
                return [];
            }
        }

        // --- è¿›å…¥å¤ä¹ æ¨¡å¼ ---
        function startReviewMode() {
            const wordsToReview = checkMemoryDecay();
            if (wordsToReview.length > 0) {
                filteredWords = words.filter(w => wordsToReview.includes(w.word));
                switchMode('cards');
                showToast(`æ­£åœ¨å¤ä¹  7 å¤©å‰æŒæ¡çš„ ${wordsToReview.length} ä¸ªå•è¯`, "ğŸ§ ");
            }
        }

        // --- æ¸²æŸ“ç»´åº¦åˆ†æå›¾è¡¨ ---
        function renderStatsCharts() {
            // 1. è¯æ€§ç¯å½¢å›¾
            const posData = analyzePOS();
            const posCtx = document.getElementById('posChart').getContext('2d');
            if (posChart) posChart.destroy();
            posChart = new Chart(posCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(posData),
                    datasets: [{
                        data: Object.values(posData),
                        backgroundColor: ['#6366f1', '#ec4899', '#f59e0b', '#10b981', '#94a3b8'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 6, font: { size: 10 } } } }
                }
            });

            // 2. å­¦ä¹ æ›²çº¿å›¾ (åŒå‰ï¼Œç•¥...)
            renderLearningChart(); 
        }

        // --- å¢å¼ºç‰ˆå‘¨æŠ¥ç‚¹è¯„é€»è¾‘ ---
        function generateCoachComment(count, acc) {
            const pos = analyzePOS();
            let comment = "";
            const total = masteredWords.size;
            
            // è¯æ€§åç§‘åˆ†æ
            const verbRatio = pos["åŠ¨è¯(v.)"] / total;
            
            if (count >= dailyGoal * 5) {
                comment = "æœ¬å‘¨å­¦ä¹ åŠ›çˆ†å‘ï¼æ•™åŠ¡æ•°æ®åˆ†ææ˜¾ç¤ºä½ å·²è¿›å…¥æ·±åº¦å­¦ä¹ é˜¶æ®µã€‚";
            } else {
                comment = "å­¦ä¹ èŠ‚å¥å¹³ç¨³ã€‚";
            }

            if (verbRatio < 0.1 && total > 20) {
                comment += " å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½ çš„åŠ¨è¯æŒæ¡æ¯”ä¾‹åä½ã€‚åœ¨èŒåœºè‹±è¯­ä¸­ï¼ŒåŠ¨è¯æ˜¯å¥å­çš„çµé­‚ï¼Œå»ºè®®ä¸‹å‘¨é’ˆå¯¹æ€§åŠ å¼ºè¡ŒåŠ¨ç±»è¯æ±‡çš„ç§¯ç´¯ã€‚";
            } else {
                comment += " è¯æ±‡ç»´åº¦åˆ†å¸ƒå‡åŒ€ï¼Œè¿™æœ‰åˆ©äºä½ æ„å»ºå¹³è¡¡çš„è¯­è¨€ä½“ç³»ã€‚";
            }
            
            document.getElementById('repComment').textContent = `â€œ ${comment} â€`;
        }

        // ä¿®æ”¹åˆå§‹åŒ–é€»è¾‘
        function initApp() {
            checkMemoryDecay();
            // æ¯å°æ—¶è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡è®°å¿†çŠ¶æ€
            setInterval(checkMemoryDecay, 3600000);
        }
    </script>
</body>
</html>
