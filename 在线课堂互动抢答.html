<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>曲靖农业学校 · 未来课堂</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts: Orbitron for Sci-Fi look -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            dark: '#050b14',
                            panel: '#0f172a',
                            primary: '#00f0ff', // Cyan
                            secondary: '#7000ff', // Purple
                            accent: '#ff003c', // Red
                            success: '#00ff9d', // Green
                            warning: '#facc15', // Yellow
                            dim: 'rgba(0, 240, 255, 0.1)'
                        }
                    },
                    fontFamily: {
                        sci: ['"Orbitron"', 'sans-serif'],
                        body: ['"Noto Sans SC"', 'sans-serif']
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 10s linear infinite',
                        'grid-move': 'gridMove 20s linear infinite',
                        'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'flash-red': 'flashRed 0.5s infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        gridMove: {
                            '0%': { backgroundPosition: '0 0' },
                            '100%': { backgroundPosition: '50px 50px' },
                        },
                        popIn: {
                            '0%': { opacity: '0', transform: 'scale(0.5)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        flashRed: {
                            '0%, 100%': { color: '#ff003c', textShadow: '0 0 15px #ff003c' },
                            '50%': { color: '#ffffff', textShadow: 'none' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-2px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(4px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-6px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(6px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050b14;
            color: #e2e8f0;
            overflow: hidden; /* Prevent scrolling for app-like feel */
        }

        /* Cyberpunk Grid Background */
        .bg-grid {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            perspective: 1000px;
            transform-style: preserve-3d;
            animation: gridMove 60s linear infinite;
            opacity: 0.4;
        }

        /* Neon Glow Effects */
        .neon-border {
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.3), inset 0 0 10px rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.5);
        }
        
        .neon-text {
            text-shadow: 0 0 5px rgba(0, 240, 255, 0.8);
        }

        .neon-text-purple {
            text-shadow: 0 0 5px rgba(112, 0, 255, 0.8);
        }
        
        .neon-text-green {
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.8);
        }

        /* Glass Panel */
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 240, 255, 0.2);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #00f0ff; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #7000ff; 
        }

        .corner-deco {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid #00f0ff;
            transition: all 0.3s;
        }
        .c-tl { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .c-tr { top: -1px; right: -1px; border-left: none; border-bottom: none; }
        .c-bl { bottom: -1px; left: -1px; border-right: none; border-top: none; }
        .c-br { bottom: -1px; right: -1px; border-left: none; border-top: none; }

        /* Badge Styles */
        .type-badge {
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: 700;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            box-shadow: 0 0 10px currentColor;
        }
        .type-single { color: #00f0ff; border: 1px solid #00f0ff; background: rgba(0, 240, 255, 0.1); }
        .type-multi { color: #facc15; border: 1px solid #facc15; background: rgba(250, 204, 21, 0.1); }
        .type-tf { color: #ff003c; border: 1px solid #ff003c; background: rgba(255, 0, 60, 0.1); }
        .type-noun { color: #d946ef; border: 1px solid #d946ef; background: rgba(217, 70, 239, 0.1); }
        .type-short { color: #00ff9d; border: 1px solid #00ff9d; background: rgba(0, 255, 157, 0.1); }
    </style>
</head>
<body class="h-screen flex flex-col font-body">

    <!-- Background -->
    <div class="bg-grid"></div>
    <div class="absolute inset-0 bg-gradient-to-t from-cyber-dark via-transparent to-transparent pointer-events-none"></div>

    <!-- Celebration Canvas Layer -->
    <canvas id="confetti-canvas" class="fixed inset-0 pointer-events-none z-50"></canvas>
    
    <!-- Celebration Text Overlay (CORRECT) -->
    <div id="celebration-text" class="fixed inset-0 flex items-center justify-center z-50 pointer-events-none hidden">
        <div class="bg-black/80 p-8 rounded-2xl border-2 border-cyber-success shadow-[0_0_50px_rgba(0,255,157,0.5)] animate-pop-in backdrop-blur-md">
            <h1 class="text-6xl md:text-8xl font-black font-sci text-white neon-text-green tracking-widest text-center">
                CORRECT!
                <div class="text-2xl md:text-3xl text-cyber-success mt-2 font-body font-bold">回答正确</div>
            </h1>
        </div>
    </div>

    <!-- Error Text Overlay (WRONG) -->
    <div id="error-overlay" class="fixed inset-0 flex items-center justify-center z-50 pointer-events-none hidden">
        <div class="bg-black/80 p-8 rounded-2xl border-2 border-cyber-accent shadow-[0_0_50px_rgba(255,0,60,0.5)] animate-shake backdrop-blur-md">
            <h1 class="text-6xl md:text-8xl font-black font-sci text-white tracking-widest text-center" style="text-shadow: 0 0 20px #ff003c;">
                WRONG
                <div class="text-2xl md:text-3xl text-cyber-accent mt-2 font-body font-bold">回答错误</div>
            </h1>
        </div>
    </div>

    <!-- Header -->
    <header class="h-16 flex items-center justify-between px-6 border-b border-cyber-primary/30 bg-cyber-dark/80 backdrop-blur-md relative z-10">
        <div class="flex items-center gap-3">
            <i data-lucide="cpu" class="text-cyber-primary w-8 h-8 animate-pulse"></i>
            <h1 class="text-2xl font-sci font-bold tracking-wider text-white neon-text">
                职业教育<span class="text-cyber-primary">曲靖农业学校</span>.课堂互动抢答
            </h1>
        </div>
        <div class="flex items-center gap-4 md:gap-6">
            <!-- Fullscreen Button -->
            <button onclick="toggleFullScreen()" id="fullscreen-btn" class="text-cyber-primary hover:text-white transition-colors p-2 rounded hover:bg-cyber-primary/10 border border-transparent hover:border-cyber-primary/30" title="全屏模式">
                <i data-lucide="expand" class="w-5 h-5"></i>
            </button>

            <div class="text-cyber-primary font-mono text-sm border border-cyber-primary/30 px-3 py-1 rounded bg-cyber-dim hidden md:block">
                SYSTEM: <span class="text-green-400">ONLINE</span>
            </div>
            <div id="clock" class="text-xl font-mono font-bold text-white">00:00:00</div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 overflow-hidden relative z-10">
        
        <!-- Left Column: Question Bank (7 cols) -->
        <section class="lg:col-span-7 flex flex-col gap-4">
            
            <!-- Question Display Card -->
            <div class="glass-panel rounded-xl p-1 flex-1 flex flex-col relative group overflow-hidden">
                <!-- Decorations -->
                <div class="corner-deco c-tl"></div><div class="corner-deco c-tr"></div>
                <div class="corner-deco c-bl"></div><div class="corner-deco c-br"></div>

                <!-- Header -->
                <div class="bg-cyber-primary/10 p-3 flex justify-between items-center border-b border-cyber-primary/20">
                    <h2 class="font-sci text-cyber-primary flex items-center gap-2">
                        <i data-lucide="database"></i> 
                        当前题目 / QUESTION DATA
                    </h2>
                    <div class="flex items-center gap-3">
                        <span id="q-type-badge" class="type-badge type-single hidden">单项选择题</span>
                        <span id="q-counter" class="text-xs font-mono text-gray-400">INDEX: 01/10</span>
                    </div>
                </div>

                <!-- Content -->
                <div class="flex-1 p-8 flex flex-col justify-center items-center relative overflow-y-auto w-full">
                    
                    <div id="question-text" class="text-3xl font-bold text-white mb-8 leading-relaxed tracking-wide drop-shadow-md transition-all duration-300 whitespace-pre-line text-center">
                        正在加载题库模块...
                    </div>
                    
                    <!-- Hidden Answer Overlay -->
                    <div id="answer-container" class="relative w-full max-w-2xl hidden transition-all duration-300">
                        <div class="absolute -top-3 left-1/2 -translate-x-1/2 text-xs text-cyber-secondary font-mono bg-cyber-dark px-2 border border-cyber-secondary">ANSWER KEY</div>
                        <!-- Answer Text: Initial class is text-center, will be modified by JS -->
                        <div id="answer-text" class="text-xl md:text-2xl text-cyber-primary font-mono p-6 border border-cyber-secondary/50 rounded bg-cyber-secondary/10 shadow-[0_0_15px_rgba(112,0,255,0.2)] text-center">
                            Answer Content
                        </div>
                    </div>

                    <!-- Placeholder for no answer shown -->
                    <div id="answer-placeholder" class="text-gray-500 font-mono text-sm animate-pulse mt-4">
                        [ WAITING FOR DECRYPTION ]
                    </div>
                </div>

                <!-- Controls -->
                <div class="p-4 bg-cyber-dark/50 border-t border-cyber-primary/20 grid grid-cols-5 gap-2 md:gap-4">
                    <!-- Prev Button -->
                    <button onclick="changeQuestion(-1)" class="col-span-1 px-2 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded text-gray-300 transition-colors flex justify-center items-center gap-1 md:gap-2">
                        <i data-lucide="chevron-left"></i> <span class="hidden md:inline">上一题</span>
                    </button>
                    
                    <!-- Show Answer Button -->
                    <button onclick="toggleAnswer()" class="col-span-1 px-2 py-3 bg-cyber-secondary/20 hover:bg-cyber-secondary/40 border border-cyber-secondary text-cyber-secondary hover:text-white font-bold tracking-wide rounded transition-all shadow-[0_0_10px_rgba(112,0,255,0.2)] hover:shadow-[0_0_20px_rgba(112,0,255,0.6)] flex justify-center items-center gap-1 md:gap-2 group">
                        <i data-lucide="eye" class="group-hover:hidden"></i>
                        <span id="btn-answer-text" class="text-xs md:text-sm">答案</span>
                    </button>

                     <!-- Wrong Answer (Error) Button -->
                     <button onclick="triggerError()" class="col-span-1 px-2 py-3 bg-cyber-accent/20 hover:bg-cyber-accent/40 border border-cyber-accent text-cyber-accent hover:text-white font-bold tracking-wide rounded transition-all shadow-[0_0_10px_rgba(255,0,60,0.2)] hover:shadow-[0_0_20px_rgba(255,0,60,0.6)] flex justify-center items-center gap-1 md:gap-2">
                        <i data-lucide="x"></i> <span class="hidden md:inline">错误</span>
                    </button>

                    <!-- Correct Answer (Bingo) Button -->
                    <button onclick="triggerCelebration()" class="col-span-1 px-2 py-3 bg-cyber-success/20 hover:bg-cyber-success/40 border border-cyber-success text-cyber-success hover:text-white font-bold tracking-wide rounded transition-all shadow-[0_0_10px_rgba(0,255,157,0.2)] hover:shadow-[0_0_20px_rgba(0,255,157,0.6)] flex justify-center items-center gap-1 md:gap-2">
                        <i data-lucide="check"></i> <span class="hidden md:inline">正确</span>
                    </button>

                    <!-- Next Button -->
                    <button onclick="changeQuestion(1)" class="col-span-1 px-2 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded text-gray-300 transition-colors flex justify-center items-center gap-1 md:gap-2">
                        <span class="hidden md:inline">下一题</span> <i data-lucide="chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Right Column: Student Randomizer (5 cols) -->
        <section class="lg:col-span-5 flex flex-col gap-4">
            
            <!-- Lottery Box -->
            <div class="glass-panel rounded-xl p-1 h-2/3 flex flex-col relative overflow-hidden transition-all duration-300" id="lottery-box">
                <div class="corner-deco c-tl border-cyber-secondary"></div><div class="corner-deco c-tr border-cyber-secondary"></div>
                <div class="corner-deco c-bl border-cyber-secondary"></div><div class="corner-deco c-br border-cyber-secondary"></div>
                
                <div class="bg-cyber-secondary/10 p-3 flex justify-between items-center border-b border-cyber-secondary/20">
                    <h2 class="font-sci text-cyber-secondary flex items-center gap-2">
                        <i data-lucide="target"></i> 
                        目标锁定 / TARGET LOCK
                    </h2>
                </div>

                <div class="flex-1 flex flex-col items-center justify-center p-6 relative z-10">
                    <!-- Decor Rings (Background) -->
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none -z-10">
                        <div class="w-64 h-64 border border-cyber-secondary/20 rounded-full animate-spin-slow"></div>
                        <div class="absolute w-48 h-48 border border-cyber-primary/20 rounded-full animate-spin-slow" style="animation-direction: reverse;"></div>
                    </div>

                    <!-- Name Display -->
                    <div id="student-name" class="text-5xl md:text-6xl font-black text-white z-10 neon-text-purple tracking-widest transition-all scale-100 mb-4 text-center">
                        READY
                    </div>
                    
                    <!-- Countdown Timer HUD (Hidden by default) -->
                    <div id="timer-container" class="hidden flex-col items-center justify-center w-full mt-4 bg-black/60 p-4 rounded-lg border border-cyber-accent/30 backdrop-blur-md animate-pop-in relative overflow-hidden group">
                        <!-- Background Decos -->
                        <div class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-cyber-accent to-transparent opacity-50"></div>
                        <div class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-cyber-accent to-transparent opacity-50"></div>

                        <!-- Timer HUD Layout -->
                        <div class="relative w-40 h-40 flex items-center justify-center">
                            <!-- Rotating Outer Ring -->
                            <div class="absolute inset-0 border-2 border-dashed border-cyber-dim rounded-full animate-spin-slow opacity-40"></div>
                            
                            <!-- Static Ring -->
                            <div class="absolute inset-2 border border-cyber-dim/30 rounded-full"></div>

                            <!-- SVG Progress Circle -->
                            <svg class="w-full h-full transform -rotate-90">
                                <!-- Background Circle -->
                                <circle cx="80" cy="80" r="70" stroke="rgba(255,255,255,0.1)" stroke-width="4" fill="transparent" />
                                <!-- Progress Circle -->
                                <circle id="timer-ring" cx="80" cy="80" r="70" stroke="currentColor" stroke-width="6" fill="transparent" stroke-linecap="round" class="text-cyber-accent transition-all duration-1000 ease-linear" />
                            </svg>

                            <!-- Digital Time Display -->
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <div class="text-[0.6rem] text-cyber-primary tracking-[0.2em] font-mono mb-1 opacity-80">T-MINUS</div>
                                <div id="timer-display" class="text-4xl font-sci font-bold text-white tracking-widest drop-shadow-[0_0_10px_rgba(255,0,60,0.5)]">
                                    02:00
                                </div>
                                <div class="text-[0.6rem] text-gray-500 font-mono mt-1 tracking-wider">SEC</div>
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="flex gap-4 mt-4 z-10">
                            <button onclick="toggleTimer()" class="group px-3 py-1 border border-cyber-primary text-cyber-primary hover:bg-cyber-primary hover:text-black text-[0.7rem] font-mono transition-colors rounded-sm uppercase tracking-wider flex items-center gap-1">
                                <i data-lucide="play-circle" class="w-3 h-3 group-hover:scale-110 transition-transform"></i> 
                                <span>Control</span>
                            </button>
                            <button onclick="resetTimer()" class="group px-3 py-1 border border-gray-500 text-gray-400 hover:border-white hover:text-white text-[0.7rem] font-mono transition-colors rounded-sm uppercase tracking-wider flex items-center gap-1">
                                <i data-lucide="rotate-ccw" class="w-3 h-3 group-hover:rotate-[-90deg] transition-transform"></i> 
                                <span>Reset</span>
                            </button>
                        </div>
                    </div>

                    <div class="text-xs text-gray-500 font-mono mt-2 z-10" id="status-text">WAITING FOR COMMAND</div>
                </div>

                <div class="p-6 bg-cyber-dark/30 z-20">
                    <button id="roll-btn" onclick="toggleRoll()" class="w-full py-4 bg-gradient-to-r from-cyber-primary to-cyber-secondary hover:from-cyan-400 hover:to-purple-500 text-black font-sci font-bold text-xl tracking-widest rounded shadow-[0_0_15px_rgba(0,240,255,0.5)] transform active:scale-95 transition-all">
                        START RANDOMIZER
                    </button>
                </div>
            </div>

            <!-- Stats / List Preview -->
            <div class="glass-panel rounded-xl p-4 h-1/3 flex flex-col relative overflow-hidden">
                <h3 class="text-xs font-mono text-gray-400 mb-2 border-b border-gray-700 pb-2">CLASS ROSTER PREVIEW</h3>
                <div id="student-list-preview" class="flex flex-wrap gap-2 overflow-y-auto content-start h-full pr-2 text-sm">
                    <!-- Populated by JS -->
                </div>
            </div>

        </section>
    </main>

    <!-- Footer Controls -->
    <footer class="h-14 bg-cyber-dark border-t border-gray-800 flex items-center justify-between px-6 z-10">
        <div class="flex items-center gap-4">
            <div class="text-xs text-gray-500 font-mono">
                V.2025.12.18 // POWERED BY 杨林—曲靖农业学校 V1.0
            </div>
            <!-- Sound Toggle -->
            <button onclick="toggleSound()" id="sound-btn" class="flex items-center gap-1 text-cyber-success hover:text-white transition-colors font-mono text-xs border border-cyber-success/30 px-2 py-1 rounded bg-cyber-success/10">
                <i data-lucide="volume-2" class="w-3 h-3"></i> <span>音效: ON</span>
            </button>
        </div>
        <button onclick="openSettings()" class="flex items-center gap-2 text-cyber-primary hover:text-white transition-colors font-mono text-sm px-4 py-1 rounded border border-transparent hover:border-cyber-primary/50 hover:bg-cyber-primary/10">
            <i data-lucide="settings" class="w-4 h-4"></i> 配置数据 / CONFIG
        </button>
    </footer>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-gray-900 border border-cyber-primary w-11/12 max-w-4xl rounded-xl shadow-[0_0_50px_rgba(0,240,255,0.2)] flex flex-col max-h-[90vh]">
            
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800 rounded-t-xl">
                <h2 class="text-xl font-sci text-cyber-primary">系统配置 / SYSTEM CONFIGURATION</h2>
                <button onclick="closeSettings()" class="text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
            </div>

            <div class="p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Question Import -->
                <div class="flex flex-col gap-2">
                    <label class="text-cyber-primary font-mono text-sm flex items-center gap-2">
                        <i data-lucide="file-text"></i> 试题导入 (格式: 题型 | 题目 | 答案)
                    </label>
                    <textarea id="input-questions" class="flex-1 h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono text-green-400 focus:border-cyber-primary focus:outline-none resize-none" 
placeholder="单选题 | 下列哪个不是编程语言? \nA. Python \nB. HTML \nC. C++ | B
多选题 | 下列属于水果的是? \nA. 苹果 \nB. 香蕉 \nC. 汽车 | AB
判断题 | 1+1=3 | 错
名词解释 | AI | Artificial Intelligence 人工智能
简答题 | 请简述CPU的功能 | 中央处理器，负责解释指令和处理数据..."></textarea>
                    <div class="text-xs text-gray-500 space-y-1">
                        <p>支持格式：<strong>题型 | 题目 | 答案</strong> (使用竖线分隔)</p>
                        <p>可用题型：<strong>单选题、多选题、判断题、名词解释、简答题</strong></p>
                        <p>提示：使用 <strong>\n</strong> 在题目中换行（例如选择题选项）</p>
                    </div>
                </div>

                <!-- Student Import -->
                <div class="flex flex-col gap-2">
                    <label class="text-cyber-secondary font-mono text-sm flex items-center gap-2">
                        <i data-lucide="users"></i> 名单导入 (每行一个姓名)
                    </label>
                    <textarea id="input-students" class="flex-1 h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono text-purple-400 focus:border-cyber-secondary focus:outline-none resize-none" placeholder="张三&#10;李四&#10;王五&#10;赵六"></textarea>
                    <p class="text-xs text-gray-500">直接粘贴学生姓名，按回车换行。</p>
                </div>
            </div>

            <div class="p-4 border-t border-gray-700 bg-gray-800 rounded-b-xl flex justify-end gap-3">
                <button onclick="closeSettings()" class="px-4 py-2 text-gray-300 hover:text-white">取消</button>
                <button onclick="saveData()" class="px-6 py-2 bg-cyber-primary text-black font-bold rounded hover:bg-cyan-400 transition-colors shadow-lg shadow-cyan-500/20">
                    <i data-lucide="save" class="w-4 h-4 inline mr-1"></i> 保存并应用
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-20 right-5 transform translate-x-full transition-transform duration-300 z-50 bg-gray-800 border-l-4 border-cyber-primary text-white px-6 py-4 rounded shadow-2xl flex items-center gap-3">
        <i data-lucide="check-circle" class="text-cyber-primary"></i>
        <span id="toast-msg">Operation Successful</span>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // State Management
        let questions = [
            { type: "单选题", q: "计算机的大脑是什么？\nA. GPU\nB. CPU\nC. RAM", a: "B. CPU" },
            { type: "多选题", q: "下列哪些属于计算机输入设备？\nA. 鼠标\nB. 显示器\nC. 键盘\nD. 打印机", a: "A. 鼠标, C. 键盘" },
            { type: "判断题", q: "1KB 等于 1000 Byte", a: "错 (1024 Byte)" },
            { type: "名词解释", q: "AI", a: "Artificial Intelligence (人工智能)" },
            { type: "简答题", q: "请简述操作系统的作用。", a: "管理硬件资源，控制程序运行，改善人机界面，为应用软件提供支持等。" }
        ];

        let students = ["张伟", "李强", "王芳", "赵杰", "孙悟空", "哪吒", "钢铁侠", "刘备", "诸葛亮", "哈利波特"];
        
        let currentQIndex = 0;
        let isAnswerVisible = false;
        let rollInterval = null;
        let isRolling = false;
        
        // Audio & Timer State
        let enableSound = true;
        let audioCtx = null;
        let timerInterval = null;
        let timerSeconds = 120; // 2 minutes
        let isTimerRunning = false;

        // Constants for SVG Circle
        const TIMER_RADIUS = 70;
        const TIMER_CIRCUMFERENCE = 2 * Math.PI * TIMER_RADIUS;

        // DOM Elements
        const elQText = document.getElementById('question-text');
        const elQAnswerContainer = document.getElementById('answer-container');
        const elQAnswerText = document.getElementById('answer-text');
        const elQAnswerPlaceholder = document.getElementById('answer-placeholder');
        const elQCounter = document.getElementById('q-counter');
        const elQTypeBadge = document.getElementById('q-type-badge');
        const elBtnAnswerText = document.getElementById('btn-answer-text');
        const elStudentName = document.getElementById('student-name');
        const elRollBtn = document.getElementById('roll-btn');
        const elStudentPreview = document.getElementById('student-list-preview');
        const elCelebrationText = document.getElementById('celebration-text');
        const elErrorOverlay = document.getElementById('error-overlay');
        const elSoundBtn = document.getElementById('sound-btn');
        const elStatusText = document.getElementById('status-text');
        
        // Timer Elements
        const elTimerContainer = document.getElementById('timer-container');
        const elTimerDisplay = document.getElementById('timer-display');
        const elTimerRing = document.getElementById('timer-ring');

        // Inputs
        const inputQuestions = document.getElementById('input-questions');
        const inputStudents = document.getElementById('input-students');

        // --- Audio System (Web Audio API) ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playTone(freq, type, duration, startTime = 0, vol = 0.1) {
            if (!enableSound || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(audioCtx.currentTime + startTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime + startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + startTime + duration);
            osc.stop(audioCtx.currentTime + startTime + duration);
        }

        function playWinSound() {
            initAudio();
            // Upward Arpeggio
            playTone(523.25, 'sine', 0.4, 0, 0.1); // C5
            playTone(659.25, 'sine', 0.4, 0.1, 0.1); // E5
            playTone(783.99, 'sine', 0.4, 0.2, 0.1); // G5
            playTone(1046.50, 'square', 0.8, 0.3, 0.05); // C6
        }
        
        function playErrorSound() {
            initAudio();
            // Descending Buzz
            playTone(150, 'sawtooth', 0.4, 0, 0.2);
            playTone(100, 'sawtooth', 0.4, 0.1, 0.2);
        }

        function playTickSound() {
            initAudio();
            // Mechanical Tick
            playTone(800, 'triangle', 0.05, 0, 0.05);
        }

        function playAlarmSound() {
             initAudio();
             if (!enableSound) return;
             const osc = audioCtx.createOscillator();
             const gain = audioCtx.createGain();
             osc.type = 'sawtooth';
             osc.frequency.setValueAtTime(800, audioCtx.currentTime);
             osc.frequency.linearRampToValueAtTime(400, audioCtx.currentTime + 0.3);
             
             osc.connect(gain);
             gain.connect(audioCtx.destination);
             
             osc.start();
             gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
             gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
             osc.stop(audioCtx.currentTime + 0.3);
        }

        function toggleSound() {
            enableSound = !enableSound;
            const icon = enableSound ? 'volume-2' : 'volume-x';
            const text = enableSound ? '音效: ON' : '音效: OFF';
            const colorClass = enableSound ? 'text-cyber-success' : 'text-gray-500';
            const bgClass = enableSound ? 'bg-cyber-success/10' : 'bg-gray-800';
            
            elSoundBtn.innerHTML = `<i data-lucide="${icon}" class="w-3 h-3"></i> <span>${text}</span>`;
            elSoundBtn.className = `flex items-center gap-1 ${colorClass} hover:text-white transition-colors font-mono text-xs border border-current px-2 py-1 rounded ${bgClass}`;
            lucide.createIcons();
            
            if (enableSound) initAudio();
        }


        // --- Initialization ---
        function init() {
            updateClock();
            setInterval(updateClock, 1000);
            renderQuestion();
            renderStudentPreview();
            
            // Initialize SVG ring
            elTimerRing.style.strokeDasharray = `${TIMER_CIRCUMFERENCE} ${TIMER_CIRCUMFERENCE}`;
            elTimerRing.style.strokeDashoffset = 0;

            // Pre-fill inputs with the new format (Type | Question | Answer)
            inputQuestions.value = questions.map(i => {
                const qClean = i.q.replace(/\n/g, '\\n');
                if (i.type) {
                    return `${i.type} | ${qClean} | ${i.a}`;
                } else {
                    return `${qClean} | ${i.a}`;
                }
            }).join('\n');
            inputStudents.value = students.join('\n');
            
            // Interaction to unlock AudioContext on some browsers
            document.body.addEventListener('click', () => {
                if (audioCtx && audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
            }, { once: true });
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB');
        }

        // --- Question Logic ---
        function renderQuestion() {
            if (questions.length === 0) {
                elQText.innerText = "暂无题目，请在配置中导入";
                elQAnswerText.innerText = "";
                elQCounter.innerText = "INDEX: 0/0";
                elQTypeBadge.classList.add('hidden');
                return;
            }
            
            const item = questions[currentQIndex];

            // Animation reset
            elQText.style.opacity = '0';
            setTimeout(() => {
                // Update Badge
                updateTypeBadge(item.type);

                elQText.innerText = item.q;
                
                // Alignment Logic
                // Reset all dynamic alignment/sizing classes for Question
                elQText.classList.remove(
                    'text-center', 'text-left', 'text-justify', 
                    'text-xl', 'text-2xl', 'text-3xl', 'text-4xl', 'text-5xl',
                    'md:text-2xl', 'md:text-3xl', 'md:text-4xl', 'md:text-5xl',
                    'px-4', 'px-8', 'md:px-16', 'md:px-24', 'w-full'
                );

                if (item.q.includes('\n')) {
                    // Choices usually have newlines -> LEFT ALIGN
                    elQText.classList.add('text-left', 'px-4', 'md:px-16', 'w-full', 'text-xl', 'md:text-2xl');
                } else if (item.type === '判断题' || item.type === '名词解释') {
                    // Short content -> CENTER ALIGN
                    elQText.classList.add('text-center', 'text-4xl', 'md:text-5xl'); 
                } else {
                    // Subjective questions (Short Answer, etc.) -> JUSTIFY ALIGN
                    elQText.classList.add('text-justify', 'px-8', 'md:px-24', 'w-full');
                    
                    if (item.q.length > 30) {
                         elQText.classList.add('text-2xl', 'md:text-3xl');
                    } else {
                         elQText.classList.add('text-3xl', 'md:text-4xl');
                    }
                }

                // --- Answer Alignment Logic ---
                elQAnswerText.classList.remove('text-center', 'text-justify');
                
                // Objective types usually have short answers -> Center
                const objectiveTypes = ['单选题', '多选题', '判断题'];
                
                if (objectiveTypes.some(t => item.type && item.type.includes(t))) {
                     elQAnswerText.classList.add('text-center');
                } else {
                     // Subjective types (简答题, 名词解释, etc.) -> Justify
                     elQAnswerText.classList.add('text-justify');
                }
                
                elQText.style.opacity = '1';
            }, 200);

            elQAnswerText.innerText = item.a;
            elQCounter.innerText = `INDEX: ${(currentQIndex + 1).toString().padStart(2, '0')}/${questions.length}`;
            
            // Reset Answer visibility
            isAnswerVisible = false;
            updateAnswerUI();
        }

        function updateTypeBadge(type) {
            if (!type) {
                elQTypeBadge.classList.add('hidden');
                return;
            }
            
            elQTypeBadge.classList.remove('hidden');
            elQTypeBadge.innerText = type;
            
            // Reset classes
            elQTypeBadge.className = 'type-badge'; // reset
            
            if (type.includes('单选')) elQTypeBadge.classList.add('type-single');
            else if (type.includes('多选')) elQTypeBadge.classList.add('type-multi');
            else if (type.includes('判断')) elQTypeBadge.classList.add('type-tf');
            else if (type.includes('名词')) elQTypeBadge.classList.add('type-noun');
            else if (type.includes('简答')) elQTypeBadge.classList.add('type-short');
            else elQTypeBadge.classList.add('type-single'); 
        }

        function changeQuestion(dir) {
            if (questions.length === 0) return;
            const newIndex = currentQIndex + dir;
            if (newIndex >= 0 && newIndex < questions.length) {
                currentQIndex = newIndex;
                renderQuestion();
            }
        }

        function toggleAnswer() {
            if (questions.length === 0) return;
            isAnswerVisible = !isAnswerVisible;
            updateAnswerUI();
        }

        function updateAnswerUI() {
            if (isAnswerVisible) {
                elQAnswerContainer.classList.remove('hidden');
                elQAnswerPlaceholder.classList.add('hidden');
                elBtnAnswerText.innerText = "隐藏";
            } else {
                elQAnswerContainer.classList.add('hidden');
                elQAnswerPlaceholder.classList.remove('hidden');
                elBtnAnswerText.innerText = "答案";
            }
        }

        // --- Celebration / Confetti Logic ---
        function triggerCelebration() {
            playWinSound(); // Sound Effect
            elCelebrationText.classList.remove('hidden');
            fireConfetti();
            setTimeout(() => {
                elCelebrationText.classList.add('hidden');
            }, 3000);
        }
        
        // --- Error Feedback Logic ---
        function triggerError() {
            playErrorSound(); // Error Sound
            elErrorOverlay.classList.remove('hidden');
            setTimeout(() => {
                elErrorOverlay.classList.add('hidden');
            }, 1000); // Shorter duration for error
        }

        // Simple Canvas Confetti
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let animationId;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function createParticle() {
            const colors = ['#00f0ff', '#7000ff', '#ff003c', '#00ff9d', '#ffffff'];
            return {
                x: window.innerWidth / 2, 
                y: window.innerHeight / 2,
                vx: (Math.random() - 0.5) * 20, 
                vy: (Math.random() - 0.5) * 20,
                size: Math.random() * 5 + 2,
                color: colors[Math.floor(Math.random() * colors.length)],
                life: 100,
                gravity: 0.1
            };
        }

        function fireConfetti() {
            for(let i=0; i<150; i++) {
                particles.push(createParticle());
            }
            if(!animationId) {
                animateConfetti();
            }
        }

        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for(let i=0; i<particles.length; i++) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += p.gravity;
                p.vx *= 0.96;
                p.vy *= 0.96;
                p.life--;
                
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            }
            
            particles = particles.filter(p => p.life > 0);

            if(particles.length > 0) {
                animationId = requestAnimationFrame(animateConfetti);
            } else {
                animationId = null;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // --- Randomizer Logic ---
        function toggleRoll() {
            if (students.length === 0) {
                showToast("错误：学生名单为空！");
                return;
            }
            if (isRolling) stopRoll(); else startRoll();
        }

        function startRoll() {
            initAudio(); // Ensure context is running
            isRolling = true;
            
            // Hide Timer if open
            clearInterval(timerInterval);
            isTimerRunning = false;
            elTimerContainer.classList.add('hidden');
            elStatusText.innerText = "SEARCHING DATABASE...";

            elRollBtn.innerText = "STOP / 停止";
            elRollBtn.classList.replace('from-cyber-primary', 'from-cyber-accent');
            elRollBtn.classList.replace('to-cyber-secondary', 'to-red-500');
            elStudentName.classList.remove('neon-text-purple', 'scale-125');
            elStudentName.classList.add('text-gray-300');
            
            rollInterval = setInterval(() => {
                const r = Math.floor(Math.random() * students.length);
                elStudentName.innerText = students[r];
            }, 50); 
        }

        function stopRoll() {
            clearInterval(rollInterval);
            isRolling = false;
            
            const winnerIndex = Math.floor(Math.random() * students.length);
            elStudentName.innerText = students[winnerIndex];
            
            elRollBtn.innerText = "START RANDOMIZER";
            elRollBtn.classList.replace('from-cyber-accent', 'from-cyber-primary');
            elRollBtn.classList.replace('to-red-500', 'to-cyber-secondary');

            elStudentName.classList.remove('text-gray-300');
            elStudentName.classList.add('neon-text-purple', 'scale-125'); 
            elStatusText.innerText = "TARGET ACQUIRED";

            playWinSound(); // Small sound on stop
            showToast(`已选中: ${students[winnerIndex]}`);
            
            // START COUNTDOWN automatically
            startTimer();
        }

        // --- Countdown Timer Logic ---
        function startTimer() {
            elTimerContainer.classList.remove('hidden');
            elTimerContainer.classList.add('flex'); // Ensure flex display
            resetTimerData();
            isTimerRunning = true;
            timerInterval = setInterval(updateTimer, 1000);
        }

        function resetTimerData() {
            timerSeconds = 120; // 2 minutes default
            updateTimerDisplay();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            resetTimerData();
        }

        function toggleTimer() {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
            } else {
                isTimerRunning = true;
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function updateTimer() {
            if (timerSeconds > 0) {
                timerSeconds--;
                playTickSound();
                updateTimerDisplay();
                
                // Alarm for last 10 seconds
                if (timerSeconds < 10) {
                    elTimerDisplay.classList.add('animate-flash-red');
                }
            } else {
                // Time's up
                clearInterval(timerInterval);
                isTimerRunning = false;
                elTimerDisplay.classList.remove('animate-flash-red');
                playAlarmSound();
                showToast("时间到！");
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const s = (timerSeconds % 60).toString().padStart(2, '0');
            elTimerDisplay.innerText = `${m}:${s}`;
            
            // Update Ring Offset
            // Full offset = Circumference (Empty)
            // 0 offset = Full
            // We want it to empty as time passes
            const totalSeconds = 120;
            const offset = TIMER_CIRCUMFERENCE - (timerSeconds / totalSeconds) * TIMER_CIRCUMFERENCE;
            elTimerRing.style.strokeDashoffset = offset;
            
            if (timerSeconds > 10) {
                elTimerDisplay.classList.remove('animate-flash-red');
            }
        }


        function renderStudentPreview() {
            elStudentPreview.innerHTML = students.map(s => 
                `<span class="px-2 py-1 bg-gray-800 border border-gray-700 rounded text-gray-400 text-xs">${s}</span>`
            ).join('');
        }

        // --- Settings / Data Management ---
        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        // --- Fullscreen Logic ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Listen for fullscreen change events to update icon
        document.addEventListener('fullscreenchange', () => {
            const btn = document.getElementById('fullscreen-btn');
            if (document.fullscreenElement) {
                btn.innerHTML = '<i data-lucide="minimize" class="w-5 h-5"></i>';
                btn.title = "退出全屏";
            } else {
                btn.innerHTML = '<i data-lucide="expand" class="w-5 h-5"></i>';
                btn.title = "全屏模式";
            }
            lucide.createIcons(); // Re-render icon
        });

        function saveData() {
            const qRaw = inputQuestions.value.trim().split('\n');
            const newQuestions = [];
            
            qRaw.forEach(line => {
                // Ignore empty lines
                if (!line.trim()) return;

                const parts = line.split('|');
                
                // Format 1: Type | Question | Answer (3 parts)
                if (parts.length >= 3) {
                    newQuestions.push({
                        type: parts[0].trim(),
                        q: parts[1].trim().replace(/\\n/g, '\n'),
                        a: parts.slice(2).join('|').trim() // Rejoin rest as answer
                    });
                } 
                // Format 2: Question | Answer (2 parts, legacy)
                else if (parts.length === 2) {
                    const qText = parts[0].trim().replace(/\\n/g, '\n');
                    // Auto-detect type
                    let detectedType = "问答题";
                    if (qText.includes('\n') || qText.includes('A.')) detectedType = "选择题";
                    
                    newQuestions.push({
                        type: detectedType,
                        q: qText,
                        a: parts[1].trim()
                    });
                }
            });

            const sRaw = inputStudents.value.trim().split('\n');
            const newStudents = sRaw.map(s => s.trim()).filter(s => s.length > 0);

            if (newQuestions.length > 0) {
                questions = newQuestions;
                currentQIndex = 0;
            }
            
            if (newStudents.length > 0) {
                students = newStudents;
            }

            renderQuestion();
            renderStudentPreview();
            closeSettings();
            showToast("数据已更新！");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-x-full');
            setTimeout(() => {
                t.classList.add('translate-x-full');
            }, 3000);
        }

        init();
    </script>
</body>
</html>